{% extends "base.html" %}

{% block title %}Edit Schedule{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">일정 수정</h1>

    {% if error %}
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
        <strong class="font-bold">오류!</strong>
        <span class="block sm:inline">{{ error }}</span>
    </div>
    {% endif %}
    {% if message %}
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
        <strong class="font-bold">성공!</strong>
        <span class="block sm:inline">{{ message }}</span>
    </div>
    {% endif %}

    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">일정 정보</h2>
        <form action="{{ url_for('edit_schedule', schedule_id=schedule.id) }}" method="POST">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="md:col-span-2 mb-4">
                    <label for="title" class="block text-gray-700 text-sm font-bold mb-2">일정 제목:</label>
                    <input type="text" name="title" id="title" value="{{ schedule.title }}"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    {% if errors and errors.title %}
                    <p class="text-red-500 text-xs italic">{{ errors.title }}</p>
                    {% endif %}
                </div>

                <div class="md:col-span-2 mb-4">
                    <label for="description" class="block text-gray-700 text-sm font-bold mb-2">설명:</label>
                    <textarea name="description" id="description"
                              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" rows="3">{{ schedule.description }}</textarea>
                </div>

                <div class="mb-4">
                    <label for="startDate" class="block text-gray-700 text-sm font-bold mb-2">시작일:</label>
                    <input type="date" name="startDate" id="startDate" value="{{ schedule.startDate }}"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    {% if errors and errors.startDate %}
                    <p class="text-red-500 text-xs italic">{{ errors.startDate }}</p>
                    {% endif %}
                </div>

                <div class="mb-4">
                    <label for="endDate" class="block text-gray-700 text-sm font-bold mb-2">종료일:</label>
                    <input type="date" name="endDate" id="endDate" value="{{ schedule.endDate }}"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    {% if errors and errors.endDate %}
                    <p class="text-red-500 text-xs italic">{{ errors.endDate }}</p>
                    {% endif %}
                </div>

                <div class="md:col-span-2 mb-4">
                    <label for="destination" class="block text-gray-700 text-sm font-bold mb-2">목적지:</label>
                    <input type="text" name="destination" id="destination" value="{{ schedule.destination }}"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    {% if errors and errors.destination %}
                    <p class="text-red-500 text-xs italic">{{ errors.destination }}</p>
                    {% endif %}
                </div>

                <div class="mb-4">
                    <label for="price" class="block text-gray-700 text-sm font-bold mb-2">가격 (원):</label>
                    <input type="number" name="price" id="price" value="{{ schedule.price }}"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" min="0">
                    {% if errors and errors.price %}
                    <p class="text-red-500 text-xs italic">{{ errors.price }}</p>
                    {% endif %}
                </div>

                <div class="mb-4">
                    <label for="maxPeople" class="block text-gray-700 text-sm font-bold mb-2">최대 인원:</label>
                    <input type="number" name="maxPeople" id="maxPeople" value="{{ schedule.maxPeople }}"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" min="1">
                    {% if errors and errors.maxPeople %}
                    <p class="text-red-500 text-xs italic">{{ errors.maxPeople }}</p>
                    {% endif %}
                </div>

                <div class="mb-4 md:col-span-2">
                    <label for="status" class="block text-gray-700 text-sm font-bold mb-2">상태:</label>
                    <select name="status" id="status"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="Active" {% if schedule.status == 'Active' %}selected{% endif %}>활성</option>
                        <option value="Inactive" {% if schedule.status == 'Inactive' %}selected{% endif %}>비활성</option>
                        <option value="Completed" {% if schedule.status == 'Completed' %}selected{% endif %}>완료</option>
                    </select>
                </div>
            </div>

            <div class="flex items-center justify-between mt-6">
                <button type="submit"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    일정 업데이트
                </button>
                <a href="{{ url_for('schedules') }}"
                   class="inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800">
                    목록으로 돌아가기
                </a>
            </div>
        </form>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">관련 예약</h2>
        {% if reservations %}
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                <tr>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">고객</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">예약 인원</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">예약 날짜</th>
                    <th scope="col" class="relative px-6 py-3">
                        <span class="sr-only">작업</span>
                    </th>
                </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                {% for reservation in reservations %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ reservation.id }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ reservation.customer_name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ reservation.num_people }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ reservation.reservation_date }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <a href="{{ url_for('edit_reservation', reservation_id=reservation.id) }}"
                           class="text-indigo-600 hover:text-indigo-900 mr-4">수정</a>
                        <form action="{{ url_for('delete_reservation', reservation_id=reservation.id) }}" method="POST"
                              class="inline" onsubmit="return confirm('정말로 이 예약을 삭제하시겠습니까?');">
                            <button type="submit" class="text-red-600 hover:text-red-900">삭제</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-gray-600">이 일정에 대한 예약이 없습니다.</p>
        {% endif %}
    </div>
</div>
{% endblock %} 